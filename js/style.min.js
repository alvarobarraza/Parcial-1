var User = [];
var currentUser = 1;

hideUser();

function hideUser() {
    document.getElementById("viewUsers").style.display = "none";
}

function viewUser() {
    document.getElementById("inputData").style.display = "block";
    document.getElementById("Tabla_materia").style.display = "block";
}

function numbersOnly(evt) {
    var myEvt = evt || window.event;
    var key = myEvt.keyCode || myEvt.which;
    key = String.fromCharCode(key);
    var regex = /[0-9]/;

    if (!regex.test(key)) {
        myEvt.returnValue = false;
        if (myEvt.preventDefault) myEvt.preventDefault();
    }
}

function load() {
    document.getElementById("userDetails").innerHTML = "";
    if (localStorage.UserRecords) {
        User = JSON.parse(localStorage.UserRecords);
        for (var i = 0; i < User.length; i++) {
            view(i, User[i].Codigo_Materia, User[i].Nombre_Materia, User[i].Creditos,User[i].Primer_corte, User[i].Segundo_corte, User[i].Tercer_corte);
        }
    }
    clearFields();
}
/* Funcion Guarda los campos*/
function store() {
    var Codigo_Materia = document.getElementById("Codigo_Materia").value;
    var Nombre_Materia = document.getElementById("Nombre_Materia").value;
    var Creditos = document.getElementById("Creditos").value;
    var Primer_corte = document.getElementById("Primer_corte").value;
    var Segundo_corte = document.getElementById("Segundo_corte").value;
    var Tercer_corte = document.getElementById("Tercer_corte").value;
    

    var UserObj = {
        Codigo_Materia: Codigo_Materia,
        Nombre_Materia: Nombre_Materia,
        Creditos: Creditos,
        Primer_corte: Primer_corte,
        Segundo_corte:Segundo_corte,
        Tercer_corte: Tercer_corte
    };

    if (currentUser == 1) {
        User.push(UserObj);
    } else {
        User.splice(currentUser, 1, UserObj);
    }

    localStorage.UserRecords = JSON.stringify(User);

    load();

    clearFields();

}
/* Funcion imprimir datos en la tabla*/
function view(id, Codigo_Materia, Nombre_Materia, Creditos,Primer_corte,Segundo_corte,Tercer_corte ) {
    var view = document.getElementById("userDetails");

    var insertRows = view.insertRow();

    insertRows.insertCell(0).innerHTML = id + 1;
    insertRows.insertCell(1).innerHTML = Codigo_Materia;
    insertRows.insertCell(2).innerHTML = Nombre_Materia;
    insertRows.insertCell(3).innerHTML = Creditos;
    insertRows.insertCell(4).innerHTML = Primer_corte;
    insertRows.insertCell(5).innerHTML = Segundo_corte;
    insertRows.insertCell(6).innerHTML = Tercer_corte;
    insertRows.insertCell(7).innerHTML = ((Primer_corte*0.3)+(Segundo_corte*0.3)+(Tercer_corte*0.4));
    insertRows.insertCell(8).innerHTML = '<div id="action"><button class="btn btn-warning" onclick="edit(' + id + ')">Edit</button>';
    insertRows.insertCell(9).innerHTML = '<div id="action"><button class="btn btn-dark" onclick="wipe(' + id + ')">Delete</button></div>';

}

/* Funcion elimina los campos*/
function wipe(id) {

    User.splice(id, 1);
    localStorage.UserRecords = JSON.stringify(User);
    load();
}

/* Funcion Limpiar los campos*/
function clearFields() {
    currentUser = 1;

    document.getElementById("Codigo_Materia").value = "";
    document.getElementById("Nombre_Materia").value = "";
    document.getElementById("Creditos").value = "";
    document.getElementById("Primer_corte").value = "";
    document.getElementById("Segundo_corte").value = "";
    document.getElementById("Tercer_corte").value = "";
    document.getElementById("submit").innerHTML = "GUARDAR";
}
/* Funcion edita los campos*/
function edit(id) {
    currentUser = id;
    var UserObj = User[id];

    document.getElementById("inputData").style.display = "block";


    document.getElementById("Codigo_Materia").value = UserObj.Codigo_Materia;
    document.getElementById("Nombre_Materia").value = UserObj.Nombre_Materia;
    document.getElementById("Creditos").value = UserObj.Creditos;
    document.getElementById("Primer_corte").value = UserObj.Primer_corte;
    document.getElementById("Segundo_corte").value = UserObj.Segundo_corte;
    document.getElementById("Tercer_corte").value = UserObj.Tercer_corte;
    document.getElementById("submit").innerHTML = "Update";
}